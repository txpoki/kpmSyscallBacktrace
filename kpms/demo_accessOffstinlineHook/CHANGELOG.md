# 更新日志

## [v9.1.0] - 2024-12-26

### 新增功能
- ✨ 添加对 `openat` 系统调用的 Hook 支持
- ✨ 支持 `do_sys_openat2` (Linux 5.6+)
- ✨ 支持 `do_sys_open` (旧版内核) 作为备用
- ✨ 自动检测和回退机制，提高兼容性

### 改进
- 📝 新增 `OPENAT_HOOK.md` 文档，详细说明 openat Hook 功能
- 📝 更新 `README.md`，反映新增的系统调用支持
- 📝 更新 `QUICK_REFERENCE.md`，添加日志过滤示例
- 🔧 改进初始化日志，显示每个 Hook 的安装状态

### 输出格式
- 新增日志前缀 `INLINE_OPENAT` 用于 openat 系统调用
- 保持原有 `INLINE_ACCESS` 前缀用于 faccessat 系统调用
- 显示目录文件描述符 (DFD) 信息

### 技术细节
- 使用 `hook_wrap4` 处理 4 参数的系统调用
- 实现智能符号查找和回退逻辑
- 在模块卸载时正确清理所有 Hook

---

## [v9.0.0] - 2024-12-26

### 重大重构
- 🔨 将单文件代码重构为模块化结构
- 📦 创建独立的栈回溯模块 (`stack_unwind.c/h`)
- 📦 创建独立的进程信息模块 (`process_info.c/h`)
- 📦 创建共享类型定义 (`common.h`)

### 代码改进
- 📉 主模块代码从 450+ 行减少到 95 行（减少 78%）
- ✅ 保持所有代码逻辑完全不变
- ✅ 保持编译结果和行为完全一致
- 🎯 提高代码可维护性和可复用性

### 文档
- 📝 新增 `REFACTORING.md` - 重构说明
- 📝 新增 `SUMMARY.md` - 重构总结
- 📝 新增 `QUICK_REFERENCE.md` - 快速参考
- 📝 新增 `test_build.sh` - 自动化测试脚本

### 模块结构
```
├── common.h              # 共享定义
├── stack_unwind.c/h      # 栈回溯模块
├── process_info.c/h      # 进程信息模块
└── accessOffstinlineHook.c  # 主模块
```

---

## [v8.x] - 之前版本

### 原始功能
- ✅ Hook `do_faccessat` 系统调用
- ✅ ARM64 栈回溯支持
- ✅ ARM32 (Thumb/ARM) 栈回溯支持
- ✅ VMA 信息解析
- ✅ 进程信息获取
- ✅ 调用栈打印

---

## 版本说明

### 版本号格式
- **主版本号**: 重大架构变更或不兼容更新
- **次版本号**: 新功能添加
- **修订号**: Bug 修复和小改进

### 兼容性
- ✅ 所有版本保持向后兼容
- ✅ 编译结果行为一致
- ✅ 外部接口稳定

---

## 未来计划

### v9.2.0 (计划中)
- [ ] 添加进程过滤功能
- [ ] 添加路径过滤功能
- [ ] 添加打开标志解析

### v9.3.0 (计划中)
- [ ] 支持 `read`/`write` 系统调用
- [ ] 添加文件操作统计
- [ ] 实现配置接口

### v10.0.0 (长期)
- [ ] 硬件断点支持
- [ ] 用户态通信接口
- [ ] 完整的调试框架

---

## 贡献

欢迎提交 Issue 和 Pull Request！

### 如何贡献
1. Fork 本项目
2. 创建特性分支
3. 提交更改
4. 创建 Pull Request

### 代码规范
- 遵循 Linux 内核编码风格
- 添加适当的注释和文档
- 确保代码通过编译测试
- 保持向后兼容性
